# Traceability Matrix: Task Management System v2 (TMS-v2)

> Confidentiality: Internal
> Repo: tms-v2
> Ticket: TMS-0001
> Branch: feature/tms-v2-poc
> Owner: Developer
> Created: 2025-12-27
> Last Updated: 2025-12-28

---

## 0. Purpose (Non-negotiable)
This document provides an auditable mapping:
- **REQ (requirements.md)** → **Contract (OpenAPI/AsyncAPI)** → **Design components** → **Implementation tasks**
Used for:
- Coverage checks (no missing REQs)
- Drift checks (no unscoped operations/components)
- Review gating

Sources of truth:
- requirements: `10_prd/requirements.md`
- OpenAPI: `30_contract/openapi.yaml`
- AsyncAPI: `30_contract/asyncapi.yaml`
- Architecture: `40_design/architecture.md`
- Design: `40_design/design.md`
- Decisions: `40_design/decisions.md`
- Tasks: `40_design/tasks.md`

---

## 1. Rules (Do not violate)
1. Every row MUST include a **REQ-ID**.
2. Each row MUST include at least one of:
   - **operationId** (HTTP), OR
   - **messageId** (Event)
3. Contract mappings MUST be consistent with:
   - OpenAPI `x-requirements`
   - AsyncAPI `x-requirements`
4. "Component" MUST be a stable name used in design documents.
5. "TASK-ID" MUST exist in tasks.md once design phase starts.
6. If a REQ is intentionally not mapped, mark it explicitly as:
   - `CoverageStatus = N/A` with a reason in Notes (rare, but allowed)

---

## 2. Status Definitions
### 2.1 CoverageStatus
- **Planned**: mapping exists, not implemented yet
- **InProgress**: implementation ongoing
- **Done**: implemented and verified against acceptance criterion
- **Deferred**: intentionally postponed (must have reason)
- **N/A**: not applicable for this feature scope (must have reason)

### 2.2 Verification
- **Unit**: unit tests cover acceptance
- **Integration**: integration tests cover acceptance
- **E2E**: end-to-end tests cover acceptance
- **Manual**: manual verification only (discouraged; must justify)
- **None**: not verified yet

---

## 3. Traceability Matrix (REQ -> Contract -> Design -> Tasks)

> Notes:
> - Use **one row per REQ** as the default.
> - If a single REQ maps to multiple operations/events, either:
>   - list multiple IDs in the same cell (comma-separated), OR
>   - split into multiple rows with the same REQ-ID and different Contract IDs (choose one style and stick to it).
> - Avoid "TBD" in review phase. Use it only in early phases.

| REQ-ID | operationId (HTTP) | messageId (Event) | Components | TASK-IDs | CoverageStatus | Verification | Notes |
|---|---|---|---|---|---|---|---|
| REQ-0001 | N/A | N/A | Development Environment | TASK-0001 | Done | E2E | Environment setup completed |
| REQ-0002 | createTask, getTask, updateTask, deleteTask | N/A | TaskService, TaskCRUD UI | TASK-0002, TASK-0003 | Done | Unit + Integration | CRUD operations fully implemented |
| REQ-0003 | listTasks (with childrenIds) | N/A | TaskService, TaskPage (hierarchy display) | TASK-0002, TASK-0004 | Done | Unit + E2E | Parent-child relationships with 2-level limit |
| REQ-0004 | listTasks | N/A | TaskPool, TaskPage | TASK-0009, TASK-0010, TASK-NEW-006 | Done | E2E | List display with hierarchical view |
| REQ-0005 | searchTasks, listTags, createTag, updateTag, deleteTag | N/A | TaskService, TagService, TaskPool (search UI) | TASK-0005, TASK-0006, TASK-NEW-005 | Done | Unit + E2E | Search/filter UI integrated in TaskPool |
| REQ-0006 | getTaskQueue, addTaskToQueue, removeTaskFromQueue, clearTaskQueue, updateQueuePosition, reorderTaskQueue | N/A | QueueService, QueuePanel | TASK-0002, TASK-0007, TASK-0011, TASK-NEW-010 | Done | Unit + Integration + E2E | Queue management with status auto-update |
| REQ-0007 | getTaskQueue | N/A | QueuePanel | TASK-0009, TASK-0011, TASK-NEW-010 | Done | E2E | Queue UI with In Progress highlighting |
| REQ-0008 | updateTask, deleteTask | N/A | TaskService (parent status sync) | TASK-NEW-001 | Done | Unit + Integration | Automatic parent status calculation |
| REQ-0009 | addTaskToQueue | N/A | QueueService (parent restriction) | TASK-NEW-002 | Done | Unit + Integration | Parent tasks cannot be queued |
| REQ-0010 | listTasks | N/A | TaskService, TaskPool | TASK-NEW-003 | Done | Unit + E2E | Shows Draft + Active tasks |
| REQ-0011 | searchTasks | N/A | TaskService, TaskPool (search bar) | TASK-0006, TASK-NEW-005 | Done | E2E | Keyword search with debounce |
| REQ-0012 | searchTasks | N/A | TaskService, TaskPool (filter chips) | TASK-0006, TASK-NEW-005 | Done | E2E | Status filters (Draft/Active/Completed) |
| REQ-0013 | listTasks (status filter) | N/A | CompletedPage | TASK-NEW-008 | Done | E2E | Completed tasks timeline view |
| REQ-0014 | listTasks (status filter) | N/A | ArchivedPage | TASK-NEW-008 | Done | E2E | Archived tasks timeline view |
| REQ-0015 | listTasks | N/A | TaskPool (list display) | TASK-NEW-006 | Done | E2E | List-style with action buttons |
| REQ-0016 | updateTask | N/A | TaskService, TaskPool | TASK-NEW-013, TASK-NEW-018 | Planned | Unit + E2E | Draft status restriction for editing |
| REQ-0017 | deleteTask | N/A | TaskService, TaskPool | TASK-NEW-013, TASK-NEW-018 | Planned | Unit + E2E | Draft status restriction for deletion |
| REQ-0018 | deleteTaskPermanently | N/A | TaskService, ArchivedPage | TASK-NEW-014, TASK-NEW-021 | Planned | Unit + E2E | Physical deletion for Archived tasks |
| REQ-0019 | listTasks | N/A | TaskService, CompletedPage, ArchivedPage | TASK-NEW-016, TASK-NEW-020 | Planned | Unit + Integration | Status parameter support |
| REQ-0020 | N/A | N/A | TaskPool | TASK-NEW-019 | Planned | E2E | Remove Completed filter chip |
| REQ-0021 | N/A | N/A | QueuePanel | TASK-NEW-022 | Planned | E2E | Queue empty state UI improvement |
| REQ-0022 | restoreTask | N/A | TaskService, ArchivedPage | TASK-NEW-015, TASK-NEW-021 | Planned | Unit + E2E | Restore Archived task to Draft |

---

## 4. Contract Drift Checks (Must be empty at Review)
> ここが埋まっている限り、レビューで「判定OK」は出せない。

### 4.1 HTTP operations without REQ mapping
(None - all operations mapped)

### 4.2 Event messages without REQ mapping
(None - all messages mapped)

### 4.3 Design components without REQ mapping
(Manual check required - components extracted from design.md)

---

## 5. Coverage Summary
- Total REQs: 22
- Mapped to HTTP: 19 (REQ-0001 is environment setup, REQ-0020 and REQ-0021 are UI-only)
- Mapped to Events: 0
- Done: 15
- InProgress: 0
- Planned: 7
- Deferred/N/A: 0
- Coverage: 100% (All REQs mapped to components and tasks)

---

## 6. Change Log
- 2025-12-27 Initial traceability matrix created (REQ-0001 to REQ-0007)
- 2025-12-28 Added REQ-0008 to REQ-0015 (new requirements for parent-child sync and UI improvements)
- 2025-12-28 Updated all CoverageStatus to Done (all 15 requirements implemented)
- 2025-12-28 Updated Components column with actual component names (TaskPool, CompletedPage, ArchivedPage, Header, QueuePanel, TaskService, QueueService, TagService)
- 2025-12-28 Updated TASK-IDs to reflect all completed tasks (including TASK-NEW-001 to TASK-NEW-011)
- 2025-12-28 Added Verification types (Unit, Integration, E2E)
- 2025-12-28 Coverage Summary updated: 100% coverage (15/15 REQs Done)
- 2025-12-28 Added REQ-0016 to REQ-0022 (new requirements for Draft state restrictions, physical deletion, restore function, list_tasks API improvement, filter UI improvement)
- 2025-12-28 Added TASK-NEW-013 to TASK-NEW-023 mappings
- 2025-12-28 Coverage Summary updated: 22 total REQs (15 Done, 7 Planned), 100% coverage
